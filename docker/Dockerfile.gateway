FROM node:20-slim AS frontend-build
WORKDIR /app

# Lockfile-first; fall back if drifted
COPY frontend/package*.json ./
RUN npm ci || npm install --legacy-peer-deps

# Copy source
COPY frontend/ .

# ðŸ”§ Drop test files so tsc/vite won't see them
RUN rm -rf src/__tests__ \
 && find src -type f \( -name "*.test.*" -o -name "*.spec.*" \) -delete

# Production build
RUN npm run build

# Trim dev deps (optional)
RUN npm ci --omit=dev || npm prune --production
